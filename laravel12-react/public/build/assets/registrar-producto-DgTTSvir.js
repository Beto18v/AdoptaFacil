import{m as T,r as g,j as e}from"./app-C9a0Z2GV.js";import{X as I}from"./x-CWg9G-ba.js";import{P as B}from"./plus-B82hh39Z.js";import"./createLucideIcon-CDVaj1tW.js";function H({isOpen:n,onClose:x,setMensaje:y,productoEditar:a,modoEdicion:i=!1}){const{data:j,setData:s,post:R,put:D,processing:w,errors:o,reset:u}=T({nombre:"",descripcion:"",precio:"",cantidad:"",imagenes:[]}),v=g.useRef(null),N=g.useRef(null),[l,b]=g.useState([]),[k,p]=g.useState([]),[c,h]=g.useState([]);g.useEffect(()=>{const t=r=>{v.current&&!v.current.contains(r.target)&&x()};return n&&document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[n,x]);const S=t=>{t.preventDefault(),i&&(a!=null&&a.id)?D(`/productos/${a.id}`,{forceFormData:!0,onSuccess:()=>{u(),b([]),p([]),h([]),x(),y("¡Producto actualizado exitosamente!")},onError:()=>{y("Error al actualizar producto. Revisa los datos e intenta nuevamente."),setTimeout(()=>{s("imagenes",[])},3e3)}}):R("/productos/store",{forceFormData:!0,onSuccess:()=>{u(),b([]),p([]),x(),y("¡Producto registrado exitosamente!")},onError:()=>{y("Error al registrar producto. Revisa los datos e intenta nuevamente."),setTimeout(()=>{s("imagenes",[])},3e3)}})};g.useEffect(()=>{n?n&&i&&a?(u(),setTimeout(()=>{const t={nombre:a.nombre||"",descripcion:a.descripcion||"",precio:a.precio||"",cantidad:a.cantidad||"",imagenes:[]};Object.entries(t).forEach(([r,d])=>{s(r,d)}),h(a.imagenes_existentes||[]),console.log("Datos de producto cargados en el formulario:",t)},300)):n&&!i&&(u(),h([])):(b([]),p([]),h([]),u())},[n,i,a,u,s]);const A=t=>{if(!t)return;const r=Array.from(t),f=3-(c.length+l.length),m=r.slice(0,f);if(m.length>0){const F=[...l,...m];b(F),s("imagenes",F),m.forEach(G=>{const P=new FileReader;P.onload=_=>{p(L=>{var C;return[...L,(C=_.target)==null?void 0:C.result]})},P.readAsDataURL(G)})}},$=t=>{const r=l.filter((f,m)=>m!==t),d=k.filter((f,m)=>m!==t);b(r),p(d),s("imagenes",r),N.current&&(N.current.value="")},z=t=>{const r=c.filter((d,f)=>f!==t);h(r)};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4 backdrop-blur-sm",children:e.jsxs("div",{ref:v,className:"w-full max-w-lg rounded-xl bg-white p-6 shadow-2xl dark:bg-gray-800",children:[e.jsx("h2",{className:"mb-6 text-center text-2xl font-bold text-gray-800 dark:text-white",children:i?"Editar Producto":"Registrar Nuevo Producto"}),e.jsxs("form",{onSubmit:S,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nombre",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nombre del producto"}),e.jsx("input",{id:"nombre",name:"nombre",type:"text",value:j.nombre,onChange:t=>s("nombre",t.target.value),placeholder:"Nombre del producto",autoComplete:"off",className:"w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"}),o.nombre&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.nombre})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"descripcion",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Descripción del producto"}),e.jsx("textarea",{id:"descripcion",name:"descripcion",value:j.descripcion,onChange:t=>s("descripcion",t.target.value),placeholder:"Descripción del producto",rows:3,autoComplete:"off",className:"w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"}),o.descripcion&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.descripcion})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"precio",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Precio"}),e.jsx("input",{id:"precio",name:"precio",type:"number",value:j.precio,onChange:t=>s("precio",t.target.value),placeholder:"Precio (ej: 25000)",autoComplete:"off",className:"w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"}),o.precio&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.precio})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cantidad",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Cantidad disponible"}),e.jsx("input",{id:"cantidad",name:"cantidad",type:"number",value:j.cantidad,onChange:t=>s("cantidad",t.target.value),placeholder:"Cantidad disponible",autoComplete:"off",className:"w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"}),o.cantidad&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.cantidad})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Imágenes del producto (hasta 3)"}),i&&c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-2 text-sm text-gray-600 dark:text-gray-400",children:"Imágenes actuales:"}),e.jsx("div",{className:"mb-4 grid grid-cols-3 gap-3",children:c.map((t,r)=>e.jsxs("div",{className:"group relative",children:[e.jsx("img",{src:`/storage/${t}`,alt:`Imagen existente ${r+1}`,className:"h-20 w-full rounded-md border border-gray-300 object-cover dark:border-gray-600"}),e.jsx("button",{type:"button",onClick:()=>z(r),className:"absolute -top-2 -right-2 rounded-full bg-red-500 p-1 text-white opacity-0 transition-opacity duration-200 group-hover:opacity-100 hover:bg-red-600",children:e.jsx(I,{className:"h-3 w-3"})})]},`existing-${r}`))})]}),k.length>0&&e.jsxs(e.Fragment,{children:[i&&e.jsx("p",{className:"mb-2 text-sm text-gray-600 dark:text-gray-400",children:"Nuevas imágenes:"}),e.jsx("div",{className:"mb-4 grid grid-cols-3 gap-3",children:k.map((t,r)=>{var d;return e.jsxs("div",{className:"group relative",children:[e.jsx("img",{src:t,alt:`Preview ${r+1}`,className:"h-20 w-full rounded-md border border-gray-300 object-cover dark:border-gray-600"}),e.jsx("button",{type:"button",onClick:()=>$(r),className:"absolute -top-2 -right-2 rounded-full bg-red-500 p-1 text-white opacity-0 transition-opacity duration-200 group-hover:opacity-100 hover:bg-red-600",children:e.jsx(I,{className:"h-3 w-3"})}),e.jsx("div",{className:"bg-opacity-50 absolute right-0 bottom-0 left-0 truncate rounded-b-md bg-black p-1 text-xs text-white",children:(d=l[r])==null?void 0:d.name})]},`new-${r}`)})})]}),c.length+l.length<3&&e.jsxs("label",{htmlFor:"imagenes-producto",className:"flex cursor-pointer flex-col items-center justify-center rounded-md border-2 border-dashed border-gray-300 bg-gray-50 p-6 text-center transition hover:bg-gray-100 dark:border-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600",children:[e.jsx(B,{className:"h-10 w-10 text-gray-400"}),e.jsx("span",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300",children:c.length+l.length===0?"Seleccionar imágenes del producto":`Agregar más imágenes (${3-(c.length+l.length)} disponibles)`}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF hasta 2MB cada una"})]}),e.jsx("input",{id:"imagenes-producto",name:"imagenes-producto",ref:N,type:"file",accept:"image/*",multiple:!0,autoComplete:"off",onChange:t=>A(t.target.files),className:"hidden"}),o.imagenes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.imagenes})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-2",children:[e.jsx("button",{type:"button",onClick:x,className:"rounded-md bg-gray-200 px-6 py-2 font-semibold text-gray-700 transition hover:bg-gray-300 dark:bg-gray-600 dark:text-white dark:hover:bg-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:w,className:"rounded-md bg-green-600 px-6 py-2 font-semibold text-white shadow-md transition hover:bg-green-700 disabled:opacity-50",children:w?i?"Actualizando...":"Registrando...":i?"Guardar cambios":"Registrar Producto"})]})]})]})}):null}export{H as default};
