import{r as n,m as Q,j as e}from"./app-C9a0Z2GV.js";import{S as X}from"./sparkles-BubAj5ih.js";import{X as E}from"./x-CWg9G-ba.js";import{P as K}from"./plus-B82hh39Z.js";import"./createLucideIcon-CDVaj1tW.js";const W=()=>{const[p,v]=n.useState(!1),[C,i]=n.useState(""),[g,b]=n.useState(""),r=n.useCallback(async t=>{var c;v(!0),b("");try{const d=await(await fetch("/api/descripciones/generar",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.getAttribute("content"))||""},body:JSON.stringify(t)})).json();if(d.success&&d.descripcion)return i(d.descripcion),d.descripcion;{const h=d.error||d.mensaje||"Error al generar descripci√≥n";return b(h),null}}catch(y){return b("Error de conexi√≥n. Verifica que el microservicio est√© activo."),console.error("Error al generar descripci√≥n:",y),null}finally{v(!1)}},[]),o=n.useCallback(async()=>{try{const c=await(await fetch("/api/descripciones/verificar-servicio")).json();return c.success&&c.servicio_activo}catch(t){return console.error("Error al verificar servicio:",t),!1}},[]),M=n.useCallback((t,c,y,d,h,j)=>{const D=j||"Mascota cari√±osa y sociable",N="En excelente estado de salud",f=`${d==="Macho"?"Es un":"Es una"} ${c.toLowerCase()} ubicado en ${h}`;return r({nombre:t,especie:c,raza:y||"Mestiza",sexo:d,personalidad:D,salud:N,observaciones:f,descripcion_actual:j})},[r]),A=n.useCallback(()=>b(""),[]);return{generandoDescripcion:p,ultimaDescripcion:C,error:g,generarDescripcion:r,generarDescripcionDesdeDatos:M,verificarServicio:o,limpiarError:A}},G=["Labrador Retriever","Golden Retriever","Pastor Alem√°n","Bulldog Franc√©s","Bulldog Ingl√©s","Beagle","Poodle","Rottweiler","Yorkshire Terrier","Dachshund","Siberian Husky","Shih Tzu","Boston Terrier","Pomerania","Border Collie","Cocker Spaniel","Boxer","Chihuahua","Malt√©s","Schnauzer","Jack Russell Terrier","Pitbull","Akita","Doberman","San Bernardo","Mestizo","Otro"],L=["Persa","Siam√©s","Maine Coon","Brit√°nico de Pelo Corto","Ragdoll","Bengal√≠","Abisinio","Birmano","Sphynx","Scottish Fold","Russian Blue","Oriental","Devon Rex","Cornish Rex","Manx","Angora Turco","Noruego del Bosque","Ex√≥tico de Pelo Corto","Bombay","Mestizo","Criollo","Otro"],ee=["Medell√≠n","Bello","Itag√º√≠","Envigado","Apartad√≥","Turbo","Rionegro","Sabaneta","La Estrella","Copacabana","Barranquilla","Soledad","Malambo","Sabanalarga","Puerto Colombia","Bogot√°","Cartagena","Magangu√©","Turbaco","Arjona","Tunja","Duitama","Sogamoso","Chiquinquir√°","Manizales","La Dorada","Chinchin√°","Villamar√≠a","Florencia","San Vicente del Cagu√°n","Yopal","Aguazul","Villanueva","Popay√°n","Santander de Quilichao","Puerto Tejada","Valledupar","Aguachica","Codazzi","Quibd√≥","Istmina","Monter√≠a","Lorica","Ceret√©","Sahag√∫n","Soacha","Girardot","Zipaquir√°","Facatativ√°","Ch√≠a","Mosquera","Fusagasug√°","Madrid","Funza","Cajic√°","Neiva","Pitalito","Garz√≥n","Riohacha","Maicao","San Juan del Cesar","Santa Marta","Ci√©naga","Fundaci√≥n","Villavicencio","Acac√≠as","Granada","Pasto","Tumaco","Ipiales","C√∫cuta","Oca√±a","Villa del Rosario","Los Patios","Mocoa","Puerto As√≠s","Armenia","Calarc√°","La Tebaida","Montenegro","Pereira","Dosquebradas","Santa Rosa de Cabal","La Virginia","San Andr√©s","Providencia","Bucaramanga","Floridablanca","Gir√≥n","Piedecuesta","Barrancabermeja","San Gil","Socorro","M√°laga","Sincelejo","Corozal","Ibagu√©","Espinal","Melgar","Honda","Cali","Palmira","Buenaventura","Tulua","Cartago","Buga","Jamund√≠","Yumbo","Mit√∫","Puerto Carre√±o"];function ne({isOpen:p,onClose:v,setMensaje:C,mascotaEditar:i,modoEdicion:g=!1,onMascotaRegistrada:b}){const{data:r,setData:o,post:M,processing:A,errors:t,reset:c}=Q({nombre:"",especie:"",raza:"",fecha_nacimiento:"",sexo:"",ciudad:"",descripcion:"",imagenes:[],_method:""}),y=n.useRef(null),d=n.useRef(null),[h,j]=n.useState([]),[D,N]=n.useState([]),[f,z]=n.useState([]),[$,w]=n.useState(""),{generandoDescripcion:F,error:R,generarDescripcionDesdeDatos:q,verificarServicio:_,limpiarError:V}=W(),[ae,I]=n.useState(null);n.useEffect(()=>{r.especie&&r.raza&&((r.especie==="perro"?G:L).includes(r.raza)||o("raza",""))},[r.especie,r.raza,o]);const B=a=>{if(!a){w("");return}const s=new Date,l=new Date(a);if(l>s){w("Fecha inv√°lida");return}let x=s.getFullYear()-l.getFullYear(),u=s.getMonth()-l.getMonth(),k=s.getDate()-l.getDate();if(k<0){u--;const P=new Date(s.getFullYear(),s.getMonth(),0).getDate();k+=P}u<0&&(x--,u+=12);const m=[];if(x>0&&m.push(x===1?"1 a√±o":`${x} a√±os`),u>0&&m.push(u===1?"1 mes":`${u} meses`),k>0&&m.push(k===1?"1 d√≠a":`${k} d√≠as`),m.length===0){w("Reci√©n nacido");return}let S="";m.length===1?S=m[0]:m.length===2?S=m.join(" y "):S=m.slice(0,-1).join(", ")+" y "+m[m.length-1],w(S)};n.useEffect(()=>{const a=s=>{y.current&&!y.current.contains(s.target)&&v()};return p&&document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[p,v]);const O=async()=>{if(!r.nombre.trim()){alert("Por favor, ingresa el nombre de la mascota antes de generar la descripci√≥n");return}if(!r.especie.trim()){alert("Por favor, selecciona la especie antes de generar la descripci√≥n");return}V();const a=await q(r.nombre,r.especie,r.raza||"Mestiza",r.sexo,r.ciudad||"Ciudad no especificada",r.descripcion);a&&o("descripcion",a)},H=a=>{a.preventDefault();const s={...r,imagenes_a_eliminar:g?[]:void 0};g&&(i!=null&&i.id)?(console.log("Enviando actualizaci√≥n con datos:",s),o("_method","PUT"),setTimeout(()=>{M(`/mascotas/${i.id}`,{forceFormData:!0,onSuccess:()=>{c(),j([]),N([]),z([]),w(""),C("¬°Mascota actualizada exitosamente!"),b?b():v()},onError:l=>{C("Error al actualizar mascota. Revisa los datos e intenta nuevamente.")}})},100)):M("/mascotas/store",{forceFormData:!0,onSuccess:()=>{c(),j([]),N([]),w(""),C("¬°Mascota registrada exitosamente!"),b?b():v()},onError:l=>{C("Error al registrar mascota. Revisa los datos e intenta nuevamente."),setTimeout(()=>{o("imagenes",[])},3e3)}})};n.useEffect(()=>{p?p&&g&&i?(c(),setTimeout(()=>{const a={nombre:i.nombre||"",especie:i.especie||"",raza:i.raza||"",fecha_nacimiento:i.fecha_nacimiento||"",sexo:i.sexo||"",ciudad:i.ciudad||"",descripcion:i.descripcion||"",imagenes:[]};Object.entries(a).forEach(([s,l])=>{o(s,l)}),z(i.imagenes_existentes||[]),i.fecha_nacimiento&&B(i.fecha_nacimiento),console.log("Datos cargados en el formulario:",a)},300)):p&&!g&&(c(),z([]),w("")):(j([]),N([]),w(""),z([]),I(null),c())},[p,g,i,c,o]),n.useEffect(()=>{p&&_().then(I)},[p,_]);const Y=a=>{if(!a)return;const s=Array.from(a),x=3-(f.length+h.length),u=s.slice(0,x);if(u.length>0){const k=[...h,...u];j(k),o("imagenes",k),u.forEach(m=>{const S=new FileReader;S.onload=P=>{N(Z=>{var T;return[...Z,(T=P.target)==null?void 0:T.result]})},S.readAsDataURL(m)})}},J=a=>{const s=h.filter((x,u)=>u!==a),l=D.filter((x,u)=>u!==a);j(s),N(l),o("imagenes",s),d.current&&(d.current.value="")},U=a=>{const s=f.filter((l,x)=>x!==a);z(s)};return p?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4 backdrop-blur-sm",children:e.jsxs("div",{ref:y,className:"w-full max-w-lg rounded-xl bg-white p-6 shadow-2xl dark:bg-gray-800",children:[e.jsx("h2",{className:"mb-6 text-center text-2xl font-bold text-gray-800 dark:text-white",children:g?"Editar Mascota":"Registrar Nueva Mascota"}),e.jsxs("form",{onSubmit:H,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("input",{id:"nombre",name:"nombre",type:"text",value:r.nombre,onChange:a=>o("nombre",a.target.value),placeholder:"Nombre de la mascota",className:"w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"}),t.nombre&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.nombre})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("select",{id:"especie",name:"especie",value:r.especie,onChange:a=>o("especie",a.target.value),className:"w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Selecciona una especie"}),e.jsx("option",{value:"perro",children:"Perro"}),e.jsx("option",{value:"gato",children:"Gato"})]}),t.especie&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.especie})]}),e.jsxs("div",{children:[e.jsxs("select",{id:"raza",name:"raza",value:r.raza,onChange:a=>o("raza",a.target.value),disabled:!r.especie,className:"w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 disabled:cursor-not-allowed disabled:bg-gray-100 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:disabled:bg-gray-600",children:[e.jsx("option",{value:"",children:r.especie?"Selecciona una raza":"Agrega una especie"}),r.especie==="perro"&&G.map(a=>e.jsx("option",{value:a,children:a},a)),r.especie==="gato"&&L.map(a=>e.jsx("option",{value:a,children:a},a))]}),t.raza&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.raza})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fecha_nacimiento",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Fecha de Nacimiento"}),e.jsx("input",{id:"fecha_nacimiento",name:"fecha_nacimiento",type:"date",value:r.fecha_nacimiento,onChange:a=>{o("fecha_nacimiento",a.target.value),B(a.target.value)},max:new Date().toISOString().split("T")[0],className:"w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"}),t.fecha_nacimiento&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.fecha_nacimiento})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edad_calculada",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Edad Actual"}),e.jsx("input",{id:"edad_calculada",name:"edad_calculada",type:"text",value:$,readOnly:!0,placeholder:"Se calcular√° autom√°ticamente",className:"w-full cursor-not-allowed rounded-md border-gray-300 bg-gray-50 p-3 text-gray-600 shadow-sm dark:border-gray-600 dark:bg-gray-600 dark:text-gray-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("select",{id:"sexo",name:"sexo",value:r.sexo,onChange:a=>o("sexo",a.target.value),className:"w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Selecciona el sexo"}),e.jsx("option",{value:"Macho",children:"Macho"}),e.jsx("option",{value:"Hembra",children:"Hembra"})]}),t.sexo&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.sexo})]}),e.jsxs("div",{children:[e.jsxs("select",{id:"ciudad",name:"ciudad",value:r.ciudad,onChange:a=>o("ciudad",a.target.value),className:"w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Selecciona una ciudad"}),ee.map(a=>e.jsx("option",{value:a,children:a},a))]}),t.ciudad&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.ciudad})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsxs("label",{htmlFor:"descripcion",className:"mb-2 flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:["Descripci√≥n y personalidad",e.jsx("button",{type:"button",onClick:O,disabled:F||!r.nombre.trim()||!r.especie.trim(),className:"flex h-6 w-6 items-center justify-center rounded-full bg-purple-600 text-white shadow-sm transition hover:bg-purple-700 disabled:cursor-not-allowed disabled:opacity-50",title:`Generar descripci√≥n con IA para ${r.nombre||"la mascota"}`,children:F?e.jsxs("svg",{className:"h-3 w-3 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx(X,{className:"h-3 w-3"})})]}),e.jsx("textarea",{id:"descripcion",name:"descripcion",value:r.descripcion,onChange:a=>o("descripcion",a.target.value),placeholder:"Descripci√≥n y personalidad de la mascota...",rows:4,className:"w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]}),t.descripcion&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.descripcion}),e.jsx("p",{className:"mt-2 text-xs font-medium text-purple-600 dark:text-purple-400",children:"üí° Haz clic en la ‚≠ê junto al t√≠tulo para generar una descripci√≥n emocional autom√°tica"}),R&&e.jsx("div",{className:"mt-2 rounded-md bg-red-50 p-3 text-sm text-red-700 dark:bg-red-900/20 dark:text-red-300",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsxs("span",{children:["Error generando descripci√≥n: ",R]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Im√°genes de la mascota (hasta 3)"}),g&&f.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-2 text-sm text-gray-600 dark:text-gray-400",children:"Im√°genes actuales:"}),e.jsx("div",{className:"mb-4 grid grid-cols-3 gap-3",children:f.map((a,s)=>e.jsxs("div",{className:"group relative",children:[e.jsx("img",{src:`/storage/${a}`,alt:`Imagen existente ${s+1}`,className:"h-20 w-full rounded-md border border-gray-300 object-cover dark:border-gray-600"}),e.jsx("button",{type:"button",onClick:()=>U(s),className:"absolute -top-2 -right-2 rounded-full bg-red-500 p-1 text-white opacity-0 transition-opacity duration-200 group-hover:opacity-100 hover:bg-red-600",children:e.jsx(E,{className:"h-3 w-3"})})]},`existing-${s}`))})]}),D.length>0&&e.jsxs(e.Fragment,{children:[g&&e.jsx("p",{className:"mb-2 text-sm text-gray-600 dark:text-gray-400",children:"Nuevas im√°genes:"}),e.jsx("div",{className:"mb-4 grid grid-cols-3 gap-3",children:D.map((a,s)=>{var l;return e.jsxs("div",{className:"group relative",children:[e.jsx("img",{src:a,alt:`Preview ${s+1}`,className:"h-20 w-full rounded-md border border-gray-300 object-cover dark:border-gray-600"}),e.jsx("button",{type:"button",onClick:()=>J(s),className:"absolute -top-2 -right-2 rounded-full bg-red-500 p-1 text-white opacity-0 transition-opacity duration-200 group-hover:opacity-100 hover:bg-red-600",children:e.jsx(E,{className:"h-3 w-3"})}),e.jsx("div",{className:"bg-opacity-50 absolute right-0 bottom-0 left-0 truncate rounded-b-md bg-black p-1 text-xs text-white",children:(l=h[s])==null?void 0:l.name})]},`new-${s}`)})})]}),f.length+h.length<3&&e.jsxs("label",{htmlFor:"imagenes-mascota",className:"flex cursor-pointer flex-col items-center justify-center rounded-md border-2 border-dashed border-gray-300 bg-gray-50 p-6 text-center transition hover:bg-gray-100 dark:border-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600",children:[e.jsx(K,{className:"h-10 w-10 text-gray-400"}),e.jsx("span",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300",children:f.length+h.length===0?"Seleccionar im√°genes de la mascota":`Agregar m√°s im√°genes (${3-(f.length+h.length)} disponibles)`}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF hasta 2MB cada una"})]}),e.jsx("input",{id:"imagenes-mascota",name:"imagenes-mascota",ref:d,type:"file",accept:"image/*",multiple:!0,autoComplete:"off",onChange:a=>Y(a.target.files),className:"hidden"}),t.imagenes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.imagenes})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-2",children:[e.jsx("button",{type:"button",onClick:v,className:"rounded-md bg-gray-200 px-6 py-2 font-semibold text-gray-700 transition hover:bg-gray-300 dark:bg-gray-600 dark:text-white dark:hover:bg-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:A,className:"rounded-md bg-blue-600 px-6 py-2 font-semibold text-white shadow-md transition hover:bg-blue-700 disabled:opacity-50",children:A?g?"Actualizando...":"Registrando...":g?"Guardar cambios":"Registrar Mascota"})]})]})]})}):null}export{ne as default};
