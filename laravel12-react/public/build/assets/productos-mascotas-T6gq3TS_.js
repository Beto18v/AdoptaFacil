import{K as I,r as s,j as o,L as U,S as f}from"./app-C9a0Z2GV.js";import{T as W}from"./theme-switcher-D1-KvWmV.js";import{A as K}from"./app-layout-BiuVrvCM.js";import G from"./producto-mascota-card-W_QGVkdY.js";import J from"./registrar-mascota-CG8Heo-t.js";import Q from"./registrar-producto-DgTTSvir.js";import"./button-Cd7vGOiK.js";import"./index-wTHh6_rQ.js";import"./index-BT6umcoc.js";import"./createLucideIcon-CDVaj1tW.js";import"./avatar-utils-DC3zEnz9.js";import"./x-CWg9G-ba.js";import"./index-D-6MT3mC.js";import"./avatar-DfpzBFwZ.js";import"./Logo-BWfBvknf.js";import"./LogoWhite-CZ6C_-JM.js";import"./chevron-right-BY3h9dfG.js";import"./shopping-cart-DrVdqaj3.js";import"./heart-BxOGmohM.js";import"./trash-2-C3AMxhCd.js";import"./sparkles-BubAj5ih.js";import"./plus-B82hh39Z.js";const V=[{title:"Productos y Mascotas",href:route("productos.mascotas")}];function Me(){var S,E,k,v;const N=I(),{items:C=[],auth:P,success:p}=N.props,R=C,q=((S=P.user)==null?void 0:S.role)==="aliado",[A,l]=s.useState(!1),[$,u]=s.useState(!1),[x,O]=s.useState(""),[m,L]=s.useState("todo"),[h,b]=s.useState(null),[_,j]=s.useState(null),[a,c]=s.useState(null),[r,d]=s.useState(null),[M,n]=s.useState(!1);s.useEffect(()=>{p&&i(p)},[p]),s.useEffect(()=>{const t=new URLSearchParams(window.location.search).get("adoptar_mascota");t&&j(Number(t))},[]);const y=R.filter(e=>(e.nombre||"").toLowerCase().includes((x||"").toLowerCase())&&(m==="todo"||e.tipo===m)),i=e=>{b(e),setTimeout(()=>b(null),4e3)},w=()=>{l(!1),c(null),n(!1)},T=()=>{w(),f.reload({only:["items"]})},X=()=>{u(!1),d(null),n(!1)},H=()=>{c(null),n(!1),l(!0)},z=()=>{d(null),n(!1),u(!0)},B=e=>{const t=e.tipo==="producto"?"compra":"adopcion";f.post(route("acciones-solicitud.store"),{tipo:t,item_id:e.id},{onSuccess:()=>i(`¡Solicitud de ${t} enviada para "${e.nombre}"!`),onError:()=>i("Ocurrió un error al registrar la solicitud.")})},D=async e=>{try{if(e.tipo==="mascota"){const t=await fetch(`/mascotas/${e.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(t.ok){const g=await t.json();c({...e,...g})}else c(e);n(!0),l(!0)}else if(e.tipo==="producto"){const t=await fetch(`/productos/${e.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(t.ok){const g=await t.json();d({...e,...g})}else d(e);n(!0),u(!0)}}catch{e.tipo==="mascota"?(c(e),n(!0),l(!0)):(d(e),n(!0),u(!0))}},F=e=>{if(confirm(`¿Estás seguro de que quieres eliminar "${e.nombre}"? Esta acción no se puede deshacer.`)){const t=e.tipo==="producto"?`/productos/${e.id}`:`/mascotas/${e.id}`;f.delete(t,{preserveScroll:!0,onSuccess:()=>i(`"${e.nombre}" ha sido eliminado.`),onError:()=>{i("No se pudo eliminar el ítem.")}})}};return o.jsxs(K,{breadcrumbs:V,children:[o.jsx(U,{title:"Productos y Mascotas"}),o.jsx("main",{className:"flex-1 overflow-y-auto bg-gradient-to-r from-green-400 to-blue-500 dark:from-green-600 dark:to-blue-700",children:o.jsxs("div",{className:"mx-auto max-w-7xl space-y-6 p-6",children:[h&&o.jsx("div",{className:"animate-fade-in rounded-lg border-l-4 border-green-500 bg-green-100 p-4 text-center text-green-800 shadow-lg dark:border-green-600 dark:bg-gray-800 dark:text-green-300",children:h}),q&&o.jsxs("div",{className:"mb-6 flex justify-center gap-4",children:[o.jsx("button",{onClick:H,className:"rounded-lg bg-blue-600 px-6 py-3 text-white shadow-md transition-transform hover:scale-105",children:"Registrar Mascota"}),o.jsx("button",{onClick:z,className:"rounded-lg bg-green-600 px-6 py-3 text-white shadow-md transition-transform hover:scale-105",children:"Registrar Producto"})]}),o.jsx(J,{isOpen:A,onClose:w,setMensaje:i,onMascotaRegistrada:T,mascotaEditar:a?{id:a.id,nombre:a.nombre||"",especie:a.especie||"",raza:a.raza||"",fecha_nacimiento:a.fecha_nacimiento||"",sexo:a.sexo||"",ciudad:a.ciudad||"",descripcion:a.descripcion||"",imagenes_existentes:a.imagenes_existentes||[]}:null,modoEdicion:M&&a!==null}),o.jsx(Q,{isOpen:$,onClose:X,setMensaje:i,productoEditar:r?{id:r.id,nombre:r.nombre||"",descripcion:r.descripcion||"",precio:((E=r.precio)==null?void 0:E.toString())||"0",cantidad:((k=r.cantidad)==null?void 0:k.toString())||"1",imagenes_existentes:((v=r.imagenes_existentes)==null?void 0:v.map(e=>e.ruta))||[]}:null,modoEdicion:M&&r!==null}),o.jsxs("div",{className:"mx-auto flex max-w-2xl flex-col items-center justify-center gap-4 rounded-lg bg-white p-4 shadow-sm md:flex-row dark:bg-gray-800",children:[o.jsx("input",{id:"text",name:"text",type:"text",value:x,onChange:e=>O(e.target.value),placeholder:"Buscar por nombre...",className:"w-full rounded-md border-gray-300 bg-white p-2 text-gray-900 transition focus:ring-2 focus:ring-blue-500 focus:outline-none md:w-1/2 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200"}),o.jsxs("select",{id:"filtro",name:"filtro",value:m,onChange:e=>L(e.target.value),className:"filtro-gray-900 w-full rounded-md border-gray-300 bg-white p-2 transition focus:ring-2 focus:ring-blue-500 focus:outline-none md:w-auto dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",children:[o.jsx("option",{value:"todo",children:"Todos"}),o.jsx("option",{value:"producto",children:"Solo productos"}),o.jsx("option",{value:"mascota",children:"Solo mascotas"})]})]}),o.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:y.map(e=>o.jsx(G,{item:e,onAction:B,onDelete:F,onEdit:D,autoOpenAdopcion:_===e.id,onAutoOpenHandled:()=>j(null)},`${e.tipo}-${e.id}`))}),y.length===0&&o.jsx("div",{className:"animate-fade-in mt-10 rounded-lg bg-white p-16 text-center text-lg text-gray-600 shadow-sm dark:bg-gray-800 dark:text-gray-400",children:"No se encontraron resultados que coincidan con tu búsqueda."})]})}),o.jsx(W,{})]})}export{Me as default};
